/* SITE ARCHITECTURE */

Opens directly from filesystem - no web server required.

/* DIRECTORY STRUCTURE */

Each page is an index.html in its own directory. The root _script/view.js
is shared across all pages. Directories may contain _asset/ for source files.

/* HTML PAGE FORMAT */

Pages contain:
  1. A <script> tag loading the relative path to _script/view.js
  2. A <noscript> tag with link to sitemap.html (for no-JS browsers)
  3. The body content (starting with an <h1>)

The script injects viewport meta, inline styles, header (breadcrumbs + section
nav), wraps content in <main>, and adds a footer with Top link.

/* LAYOUT */

Single column, full width, browser defaults. Sticky header with backdrop blur.

Breadcrumbs and section nav both left-aligned with gap between.

/* NAVIGATION */

Pages with children are "sections". Pages without children are "leaves".

Site title: Bold link to home, text from sitemap root entry.

Breadcrumbs: Path to current section with / separator. All items linked
except current section (plain text). Leaf pages don't add breadcrumb depth.

Section nav: Children of current section. On leaf pages, shows siblings
with current page as plain text.

Unlisted pages: Pages not in the sitemap inherit navigation from their
nearest ancestor that is in the sitemap. For example, individual blog posts
show the same navigation as the blog section page.

Footer: Right-aligned Top link, only visible when page is scrollable and
not at top.

/* SITEMAP */

Navigation structure is defined in sitemap/index.html. Run `make sitemap`
to generate _script/sitemap.js which is loaded by view.js. The sitemap
page appears in navigation like any other page.

/* AUTHORING */

To create a new page:
  1. Create a directory with index.html
  2. Add script tag, noscript tag, and content starting with <h1>
  3. Add the page to sitemap.html
  4. Run `make sitemap`

/* EDITING */

Ctrl+E or ?edit enters edit mode. Content becomes editable in the browser.
The footer is hidden and content is constrained to max 1000px width.

Keyboard shortcuts:
  Ctrl+2/3/4  Heading levels
  Ctrl+0      Paragraph
  Ctrl+L      Bulleted list
  Tab         Indent list item
  Shift+Tab   Dedent list item
  Ctrl+K      Add/edit link (select text first, prompt for URL, empty to remove)
  Ctrl+B      Bold/strong (select text first)
  Ctrl+I      Italic/em (text selected) or image alt text (image selected)

Selection in JS: Text selection returns content via selection.toString().
Image selection brackets the element within its parent - the range's
startContainer equals endContainer, and endOffset - startOffset equals 1,
with the image at childNodes[startOffset].

Drag and drop images onto page to insert. Images show as previews and are
referenced by SHA256 hash (first 12 chars) as _gallery/HASH.jpg. Image
dimensions are stored as data-width and data-height attributes.

Image rows: Images on the same line form a gallery row. Press Enter between
images to create separate rows. The saved HTML preserves line breaks which
view.js uses to build the gallery table.

Saving:
  "Copy HTML" - copies formatted HTML to clipboard via navigator.clipboard API
  "Save" - (server mode only) POSTs the HTML to the server, which writes it
           directly to the file. Only appears when served via HTTP.
  "Download" - creates a Blob with text/html content, generates a temporary URL
               via URL.createObjectURL(), triggers download via anchor click.
               Right-click and "Save As" to choose location.
  "View" - exits edit mode (navigates to page without ?edit)

/* DEVELOPMENT SERVER */

Run `make serve` to start the development server. This uses serve.py, a simple
Python HTTP server that serves static files and handles POST requests to save
edited pages directly to disk.

The server:
  - Binds to 0.0.0.0:8000 (accessible from other devices on the network)
  - Serves static files like Python's built-in http.server
  - Accepts POST to any /path/index.html and writes the body to that file
  - Redirects back to the page after saving

serve.py is intentionally minimal and readable - see the source for details.

/* IMAGE GALLERIES */

Consecutive <img> tags form a row. The script wraps them in a flex container
with equal widths. Separate rows with any block element (p, h2, etc).

/* IMAGE PROCESSING */

Images are content-addressed by SHA256 hash. Workflow:

  1. `make index`   - scans ~/Pictures, builds ~/.cache/picture-index
  2. Drag images in edit mode - computes hash, inserts _gallery/HASH.jpg
  3. `make gallery` - finds hashes in HTML, generates thumbnails from index

Generates multiple sizes; HASH.jpg symlinks to a mid-size as no-JS fallback.
See Makefile for sizes and compression settings. Requires ImageMagick.

view.js picks the appropriate size based on display width Ã— device pixel
ratio (capped at 2x), so mobile gets smaller files while retina stays sharp.

/* NO-JS FALLBACK */

Each page includes a <noscript> link to sitemap.html. Browsers without
JavaScript (lynx, w3m, links, elinks) can navigate via the sitemap.
